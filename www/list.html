<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <title>Deadline</title>
        <link rel="stylesheet" href="css/all.min.css">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/style.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/script.js"></script>
        <script src="js/events.js"></script>
        <script src="js/date_get.js"></script>
        <script>
            var date = findGetParameter("date");

            function formatDate(date) {
                var dateN;
                console.log(date.length);
                if (date.length == 9) {
                    if ((date.lastIndexOf("-")) - (date.indexOf("-")) < 3) {
                        dateN = date.substr(0, 5).concat("0", date.substr(5, 8));
                    }
                    else {
                        dateN = date.substr(0, 8).concat("0", date.substr(8, 8));
                    }
                }
                if (date.length == 8) {
                    var an = date.substr(0, 5);
                    var mois = "0".concat(date.substr(5, 2));
                    var jour = "0".concat(date.substr(7, 8));
                    dateN = an.concat(mois, jour);
                }
                if(date.length==10){
                    dateN=date;
                }
                return dateN;
            }

            formatDate (date);

            console.log(date);
            let myDB = window.openDatabase("Events00000000", "1.0", "All Deadlines", 2000000);
            myDB.transaction(function (txn) {
                txn.executeSql("SELECT * FROM events WHERE start=?", [date], function (tx, res) {
                    console.log(res);
                    let list = document.getElementById("list");
                    for (let i = 0; i < res.rows.length; i++) {
                        let button = document.createElement("a");
                        button.setAttribute('id', res.rows[i].id);
                        list.append(button);
                        button.append('"' + res.rows[i].title + '", ');
                        if (res.rows[i].content) {
                            button.append('"' + res.rows[i].content + '", ');
                        }
                        if (res.rows[i].end) {
                            button.append('entre le ' + res.rows[i].start);
                            button.append('et le ' + res.rows[i].end);
                        } else {
                            button.append('pour le ' + res.rows[i].start);
                        }
                        button.classList.add('btn');
                        button.classList.add('btn-outline-primary');
                        button.href = "modSupDeadline.html?date=" + date + "&id=" + res.rows[i].id;
                        let br = document.createElement("br");
                        list.append(br);
                    }
                }, function (tx, err) {
                    console.warn('Err[' + err.code + ']: ' + err.message);
                });
            });
        </script>
    </head>
    <body>
        <header class="navbar navbar-dark bg-primary">
            <span class="navbar-brand mb-0 h1">Liste</span>
            <span onclick="window.location='home.html';" class="icon">
                <i class="fas fa-arrow-left"></i>
            </span> 
        </header>
        <div id="form-event" class="card-fade">
            <br>
            <br>
            <br>
            <h3>Il y a plusieurs deadlines pour ce jour:</h3>
        	<div id="list">
        	</div>
        </div>
    </body>
</html>